<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sono Presta</title>
  <link rel="icon" href="/lovable-uploads/favicon.png" type="image/png" />
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <link rel="stylesheet" href="/assets/index-C6vqGjm2.css" crossorigin>

  <script>
    (function () {
      const CLUSTER_HTTP = "http://sonoprf.cluster100.hosting.ovh.net";
      const CLUSTER_HTTPS = "https://sonoprf.cluster100.hosting.ovh.net";
      const DOMAIN = "https://sonopresta.com"; // ðŸ‘‰ ton domaine en HTTPS

      function fixUrl(u) {
        if (!u || typeof u !== "string") return u;
        if (u.startsWith(CLUSTER_HTTP))  return DOMAIN + u.slice(CLUSTER_HTTP.length);
        if (u.startsWith(CLUSTER_HTTPS)) return DOMAIN + u.slice(CLUSTER_HTTPS.length);
        return u;
      }

      function rewriteAttributes(root=document) {
        const nodes = root.querySelectorAll('[src],[href]');
        nodes.forEach(el => {
          if (el.hasAttribute('src')) {
            const v = el.getAttribute('src');
            const f = fixUrl(v);
            if (f && f !== v) el.setAttribute('src', f);
          }
          if (el.hasAttribute('href')) {
            const v = el.getAttribute('href');
            const f = fixUrl(v);
            if (f && f !== v) el.setAttribute('href', f);
          }
        });
      }

      // MutationObserver
      const mo = new MutationObserver(muts => {
        muts.forEach(m => {
          m.addedNodes && m.addedNodes.forEach(n => {
            if (n.nodeType === 1) rewriteAttributes(n);
          });
        });
      });
      mo.observe(document.documentElement, { childList: true, subtree: true });

      // fetch
        const _fetch = window.fetch;
        window.fetch = async function (input, init = {}) {
          let url = typeof input === "string" ? input : input.url;
          const fixed = fixUrl(url);
          if (fixed && fixed !== url) {
            input = (typeof input === "string") ? fixed : new Request(fixed, input);
            url = fixed;
          }
          if (/\/backend\/public\/api\/(option\/customizer|brochures|blogs)/.test(url)) {
            init.method = 'GET';
            delete init.body;
          }
          try {
            const resp = await _fetch.call(this, input, init);
            if (!resp.ok && /\/backend\/public\/api\/(option\/customizer|brochures|blogs)/.test(url)) {
              console.warn('API error', url, resp.status);
              return new Response('[]', {status:200, headers:{'Content-Type':'application/json'}});
            }
            return resp;
          } catch (err) {
            if (/\/backend\/public\/api\/(option\/customizer|brochures|blogs)/.test(url)) {
              console.warn('API network error', url, err);
              return new Response('[]', {status:200, headers:{'Content-Type':'application/json'}});
            }
            throw err;
          }
        };

      // XHR
      const _open = XMLHttpRequest.prototype.open;
      XMLHttpRequest.prototype.open = function (method, url, ...rest) {
        const fixed = fixUrl(url);
        return _open.call(this, method, fixed || url, ...rest);
      };

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => rewriteAttributes());
      } else {
        rewriteAttributes();
      }
    })();
  </script>
</head>

<body>
  <div id="root"></div>
  <script>
    window.addEventListener('error', () => {
      const el = document.getElementById('root');
      if (el) {
        el.innerHTML = '<p>Une erreur est survenue. Merci de recharger la page.</p><button onclick="location.reload()">RÃ©essayer</button>';
      }
    });
  </script>
  <script type="module" src="/assets/index-BklUmdma.js" crossorigin></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const f = document.createElement("iframe");
      f.src = "https://www.applimova.ai/embededChatbot?id=685fbca476d3455e5de48275";
      const small = innerWidth < 768;
      const w = small ? "90%" : "420px";
      const h = small ? "calc(100vh - 100px)" : "600px";
      Object.assign(f.style, {
        position: "fixed", bottom: "0", right: small ? "5%" : "30px",
        border: "none", zIndex: "1000", width: w, height: h, borderRadius: "10px"
      });
      document.body.appendChild(f);
      window.addEventListener("message", ev => {
        const d = ev.data;
        if (d && typeof d === "object") {
          if (d.chatbotOpen === true)  { f.style.width = w;  f.style.height = h; }
          if (d.chatbotOpen === false) { f.style.width = "50px"; f.style.height = "70px"; }
        }
      });
    });
  </script>

  <div id="google_translate_element"></div>
  <script>
    function googleTranslateElementInit() {
      new google.translate.TranslateElement(
        {pageLanguage: "fr", includedLanguages: "fr,en",
         layout: google.translate.TranslateElement.InlineLayout.SIMPLE},
        "google_translate_element"
      );
    }
  </script>
  <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <style>
    #google_translate_element { position: fixed; top: 18px; right: 18px; z-index: 9999; }
    .goog-logo-link, .goog-te-gadget span { display: none !important; }
    .goog-te-gadget{ font-size:0 !important; }
    .goog-te-combo{ font-size:16px!important; padding:12px 20px; width:200px!important;
      border:1px solid #ccc; border-radius:8px; background:#fff; color:#000; outline:none;
      appearance:none; background-image:url("data:image/svg+xml,%3Csvg fill='gray' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
      background-repeat:no-repeat; background-position:right 15px center; background-size:16px;
      box-shadow:0 4px 8px rgba(0,0,0,.15); }
    .goog-te-gadget-simple{ padding:7px; white-space:nowrap; border-radius:8px; box-shadow:0 0 10px #e5e5e5; }
    iframe.goog-te-banner-frame{ display:none !important; }
  </style>
</body>
</html>
